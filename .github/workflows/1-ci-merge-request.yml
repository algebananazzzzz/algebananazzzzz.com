# .github/workflows/ci-merge-request.yml
name: Merge Request CI

# Trigger:
# - Runs when a pull request targets the `main` branch
on:
  pull_request:
    branches:
      - main

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-static-assets:
    name: ⚙️ Build Gatsby Static Assets
    runs-on: ubuntu-latest

    steps:
      - name: 1. Checkout repository (without submodules)
        uses: actions/checkout@v4
        with:
          submodules: false
          fetch-depth: 0

      - name: 2. Initialize and update submodules
        run: |
          git submodule sync --recursive
          git submodule update --init --recursive --depth=1

      - name: 3. List submodule directory
        run: |
          echo "Submodule folder:"
          ls -al infra/modules || echo "❌ Submodule 'infra/modules' not found"

      - name: 4. Show .gitmodules
        run: |
          echo "Contents of .gitmodules:"
          cat .gitmodules || echo "No .gitmodules file"
